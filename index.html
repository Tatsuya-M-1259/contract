<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>天草市 随意契約判定ガイド</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* カスタムフォントと基本設定 */
        :root {
            --primary-color: #10B981; /* Emerald */
            --secondary-color: #059669; /* Dark Emerald */
        }
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f3f4f6;
        }
        .contract-card {
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
            transition: all 0.3s ease;
        }
        .custom-select {
            appearance: none;
            background-image: url("data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 20 20' fill='%2310B981'%3e%3cpath fill-rule='evenodd' d='M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z' clip-rule='evenodd'/%3e%3c/svg%3e");
            background-repeat: no-repeat;
            background-position: right 0.5rem center;
            background-size: 1.5em 1.5em;
        }
        .result-box {
            border-left: 5px solid var(--primary-color);
            transition: all 0.5s ease-in-out;
        }
    </style>
</head>
<body class="p-4 sm:p-8 min-h-screen">

    <div class="max-w-4xl mx-auto">
        <header class="text-center mb-8">
            <h1 class="text-3xl sm:text-4xl font-extrabold text-gray-800 border-b-4 border-emerald-500 pb-2 inline-block">天草市 随意契約 根拠条文 判定ナビ</h1>
            <p class="mt-3 text-lg text-gray-600">ガイドライン（R7改訂）に基づき、契約根拠と手続きをサポートします。</p>
        </header>

        <!-- メインコンテンツグリッド -->
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">

            <!-- 入力/判定エリア -->
            <div class="bg-white p-6 sm:p-8 rounded-xl contract-card">
                <h2 class="text-2xl font-bold mb-6 text-emerald-600">契約情報の入力</h2>
                
                <!-- 1. 契約の種類 -->
                <div class="mb-5">
                    <label for="contractType" class="block text-sm font-medium text-gray-700 mb-1">1. 契約の種類</label>
                    <select id="contractType" class="custom-select mt-1 block w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-emerald-500 focus:border-emerald-500 sm:text-sm rounded-md shadow-sm">
                        <option value="">選択してください</option>
                        <option value="1">工事又は製造の請負 (例: 印刷物含む)</option>
                        <option value="2">財産の買入れ (例: 土地、備品)</option>
                        <option value="3">物件の借入れ (例: 契約期間中の賃借料総額)</option>
                        <option value="4">財産の売払い</option>
                        <option value="5">物件の貸付け (例: 契約期間中の賃貸料総額)</option>
                        <option value="6">前各号に掲げる以外のもの (例: 業務委託、役務の提供)</option>
                    </select>
                </div>

                <!-- 2. 予定価格 -->
                <div class="mb-6">
                    <label for="plannedPrice" class="block text-sm font-medium text-gray-700 mb-1">2. 予定価格 (税抜・単位: 万円)</label>
                    <input type="number" id="plannedPrice" min="0" placeholder="例: 150" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-emerald-500 focus:border-emerald-500 sm:text-sm">
                    <p class="mt-1 text-xs text-gray-500">※施行令第167条の2第1項第1号の金額判定に使用します。</p>
                </div>

                <!-- 3. 特殊な随意契約事由 (第2号〜第9号) -->
                <div class="mb-6">
                    <label class="block text-sm font-medium text-gray-700 mb-2">3. 特殊な契約事由 (該当する場合)</label>
                    <div class="space-y-2 text-sm">
                        <div class="flex items-start">
                            <input id="reason2" name="specialReason" type="radio" value="2" class="focus:ring-emerald-500 h-4 w-4 text-emerald-600 border-gray-300 mt-1">
                            <label for="reason2" class="ml-3 block text-gray-900">第2号: 性質・目的が競争入札に適しない (特殊技術/特許権/不動産/コンペ等)</label>
                        </div>
                        <div class="flex items-start">
                            <input id="reason3" name="specialReason" type="radio" value="3" class="focus:ring-emerald-500 h-4 w-4 text-emerald-600 border-gray-300 mt-1">
                            <label for="reason3" class="ml-3 block text-gray-900">第3号: 福祉施設等 (障害者支援施設/シルバー人材センター/母子福祉団体等)</label>
                        </div>
                        <div class="flex items-start">
                            <input id="reason5" name="specialReason" type="radio" value="5" class="focus:ring-emerald-500 h-4 w-4 text-emerald-600 border-gray-300 mt-1">
                            <label for="reason5" class="ml-3 block text-gray-900">第5号: 緊急の必要 (災害/応急復旧/蔓延防止等)</label>
                        </div>
                        <div class="flex items-start">
                            <input id="reason6" name="specialReason" type="radio" value="6" class="focus:ring-emerald-500 h-4 w-4 text-emerald-600 border-gray-300 mt-1">
                            <label for="reason6" class="ml-3 block text-gray-900">第6号: 競争入札に付することが不利 (追加工事/継続業務で有利等)</label>
                        </div>
                        <div class="flex items-start">
                            <input id="reason7" name="specialReason" type="radio" value="7" class="focus:ring-emerald-500 h-4 w-4 text-emerald-600 border-gray-300 mt-1">
                            <label for="reason7" class="ml-3 block text-gray-900">第7号: 時価に比べて著しく有利な価格での契約見込み (原版保有印刷物等)</label>
                        </div>
                        <div class="flex items-start">
                            <input id="reason8" name="specialReason" type="radio" value="8" class="focus:ring-emerald-500 h-4 w-4 text-emerald-600 border-gray-300 mt-1">
                            <label for="reason8" class="ml-3 block text-gray-900">第8号: 入札者がない/再度の入札で落札者がない (入札不調)</label>
                        </div>
                        <div class="flex items-start">
                            <input id="reason9" name="specialReason" type="radio" value="9" class="focus:ring-emerald-500 h-4 w-4 text-emerald-600 border-gray-300 mt-1">
                            <label for="reason9" class="ml-3 block text-gray-900">第9号: 落札者が契約を締結しない (落札者辞退等)</label>
                        </div>
                        <div class="flex items-start">
                            <input id="reasonNone" name="specialReason" type="radio" value="0" checked class="focus:ring-emerald-500 h-4 w-4 text-emerald-600 border-gray-300 mt-1">
                            <label for="reasonNone" class="ml-3 block text-gray-900">該当する特殊事由はない</label>
                        </div>
                    </div>
                </div>

                <button onclick="judgeContract()" class="w-full py-3 bg-emerald-500 text-white font-semibold rounded-lg shadow-md hover:bg-emerald-600 transition duration-150">
                    契約根拠を判定する
                </button>
            </div>

            <!-- 結果表示エリア -->
            <div id="resultOutput" class="bg-white p-6 sm:p-8 rounded-xl contract-card hidden result-box">
                <h2 class="text-2xl font-bold mb-4 text-secondary-color">判定結果と手続き</h2>
                
                <div class="space-y-4">
                    <!-- 根拠条文 -->
                    <div>
                        <p class="text-xs font-semibold uppercase text-gray-500">随意契約の根拠条文</p>
                        <p id="resultArticle" class="text-xl font-extrabold text-emerald-600"></p>
                    </div>

                    <!-- 見積徴取の要否 -->
                    <div>
                        <p class="text-xs font-semibold uppercase text-gray-500">見積徴取の要否</p>
                        <p id="resultQuotation" class="text-lg font-bold text-gray-800"></p>
                    </div>
                    
                    <!-- 注意事項・必要書類 -->
                    <div>
                        <p class="text-xs font-semibold uppercase text-gray-500">注意事項と必要書類</p>
                        <div id="resultNotes" class="mt-2 p-3 bg-emerald-50 border-l-4 border-emerald-500 rounded-md text-sm text-gray-700 space-y-1">
                            <p id="note1"></p>
                            <p id="note2"></p>
                            <p id="note3"></p>
                        </div>
                    </div>

                    <!-- 判定フロー補足 -->
                    <div class="pt-4 border-t border-gray-200">
                        <p class="text-xs font-semibold uppercase text-gray-500">判定フロー補足</p>
                        <p id="resultFlow" class="text-xs text-gray-600 mt-1 italic"></p>
                    </div>
                </div>
            </div>

        </div>
    </div>

    <script>
        // 随意契約の金額上限 (施行令第167条の2第1項第1号、規則第15条) - 単位: 万円
        const PRICE_LIMITS = {
            '1': 200, // 工事又は製造の請負
            '2': 150, // 財産の買入れ
            '3': 80,  // 物件の借入れ
            '4': 50,  // 財産の売払い
            '5': 30,  // 物件の貸付け
            '6': 100  // 前各号に掲げる以外のもの (業務委託等)
        };

        // 各随意契約事由の定義と1者随契の可否
        const REASON_DETAILS = {
            // 第1号は別扱い
            '2': {
                name: '第2号 (性質又は目的が競争入札に適しない)',
                oneParty: true,
                notes: '不動産の買入れ・借入れ、特殊技術、特許権等。契約の目的達成に特定の者が必要。',
                document: '「随意契約及び業者選定理由書」に採用した理由、業者選定理由を明確に記載すること。'
            },
            '3': {
                name: '第3号 (福祉関係施設等からの買入れ・役務)',
                oneParty: true, // 規則第14条第1項第4号による。
                notes: '障害者支援施設等、シルバー人材センター、母子福祉団体等との契約。',
                document: '「随意契約及び業者選定理由書」に採用した理由、業者選定理由を明確に記載すること。**【重要】公表手続き（発注の見通し、契約締結後）が必要。**'
            },
            '5': {
                name: '第5号 (緊急の必要)',
                oneParty: true,
                notes: '天災地変等、予見し得ない緊急事態による。年度末等の予算執行上の都合は対象外。',
                document: '「随意契約及び業者選定理由書」に採用した理由、業者選定理由を明確に記載すること。'
            },
            '6': {
                name: '第6号 (競争入札に付することが不利)',
                oneParty: true, // 規則第14条第1項第4号による。
                notes: '現履行中の受託者にさせた方が工期短縮、経費節減等で有利な場合。',
                document: '「随意契約及び業者選定理由書」に採用した理由、業者選定理由を明確に記載すること。'
            },
            '7': {
                name: '第7号 (時価に比べて著しく有利な価格)',
                oneParty: false, // 原則2者以上
                notes: '他の者に比べて著しく有利な価格で契約できる見込みがある場合。',
                document: '「随意契約及び業者選定理由書」に採用した理由、業者選定理由を明確に記載すること。**【重要】2者以上の者に見積書を依頼し、比較検討すること。**'
            },
            '8': {
                name: '第8号 (入札不調)',
                oneParty: false, // 原則2者以上
                notes: '入札者がない、又は再度の入札で落札者がない場合。',
                document: '「随意契約及び業者選定理由書」に採用した理由、業者選定理由を明確に記載すること。**【重要】契約保証金・履行期限を除き、当初の予定価格・条件を変更不可。**'
            },
            '9': {
                name: '第9号 (落札者が契約を締結しない)',
                oneParty: false, // 原則2者以上
                notes: '落札者が辞退・倒産等で契約締結しない場合。',
                document: '「随意契約及び業者選定理由書」に採用した理由、業者選定理由を明確に記載すること。**【重要】落札金額の制限内で見積合わせ。履行期限を除き、当初の条件を変更不可。**'
            },
        };

        /**
         * 契約根拠を判定し、結果を出力する
         */
        function judgeContract() {
            const contractType = document.getElementById('contractType').value;
            const priceMan = parseFloat(document.getElementById('plannedPrice').value);
            const specialReasonElement = document.querySelector('input[name="specialReason"]:checked');
            const specialReason = specialReasonElement ? specialReasonElement.value : '0';

            const output = document.getElementById('resultOutput');
            const resultArticle = document.getElementById('resultArticle');
            const resultQuotation = document.getElementById('resultQuotation');
            const resultNotes = document.getElementById('resultNotes');
            const resultFlow = document.getElementById('resultFlow');
            
            // 入力チェック
            if (!contractType || isNaN(priceMan) || priceMan < 0) {
                alert('契約の種類と予定価格を正しく入力してください。');
                return;
            }

            let article = '';
            let quotationDetail = '';
            let notes = [];
            let flowNote = '判定は、ガイドラインの「第1号優先適用」の原則に基づき行いました。';

            // 1. 少額随契 (第1号) の判定
            const priceLimit = PRICE_LIMITS[contractType];
            const isMinorContract = priceMan <= priceLimit;
            
            // 2. 特殊事由の判定
            const isSpecialReason = specialReason !== '0';
            
            if (isMinorContract) {
                // パターンA: 少額随契に該当する場合 (第1号優先適用)
                article = `施行令第167条の2第1項第1号 (少額随契 - ${priceLimit}万円以下)`;
                
                // 見積徴取の判定（規則第14条）
                if (priceMan <= 10) {
                    // 10万円以下は1者随契 (規則第14条第1項第3号)
                    quotationDetail = '1者のみの徴取で足りる (規則第14条第1項第3号)';
                } else if (specialReason === '7' || specialReason === '8' || specialReason === '9') {
                    // 第7号、8号、9号が重なる場合、少額であっても競争性を確保する必要があるため、原則2者以上を強く推奨
                    quotationDetail = '原則として2者以上の徴取が必要 (第7/8/9号事由が重なるため競争性を確保)';
                    notes.push('【例外的な競争性の確保】第7号、8号、9号の事由が重なる場合、少額であっても時価や競争性を比較検討するため、原則として2者以上の見積徴取を強く推奨します。');
                } else {
                    // それ以外は原則2者以上 (規則第14条)
                    quotationDetail = '原則として2者以上の徴取が必要';
                }

                // 予定価格調書 (規則第13条第2項第1号)
                if (priceMan <= 50) {
                    notes.push('予定価格調書の作成は省略可能 (50万円以下)');
                } else {
                    notes.push('予定価格調書を作成すること (50万円超)');
                }
                
                // 随意契約及び業者選定理由書 (ガイドラインP.10)
                if (priceMan <= priceLimit && priceMan > 10 && specialReason === '0' ) {
                    notes.push('見積予定業者が複数で、執行伺書に根拠条文と見積予定業者(複数者)の記載があれば、理由書の添付は**不要**です。');
                } else if (isSpecialReason) {
                    notes.push('【特殊事由あり】第1号優先適用ですが、特殊事由が重なる場合は「随意契約及び業者選定理由書」を作成添付し、業者選定理由を明確にすること。');
                    if (specialReason === '3') {
                        notes.push('**【重要】第3号(福祉施設等)の公表手続きが必要です。**');
                    }
                } else {
                    // 10万円以下、または10万円超50万円以下で特殊事由がない場合
                    notes.push('原則として2者以上の見積徴取が必要。執行伺書に根拠条文と見積予定業者を記載してください。');
                }
                
                flowNote += `（予定価格 ${priceMan}万円は上限額 ${priceLimit}万円以下のため、第1号が優先適用されました。）`;

            } else if (isSpecialReason) {
                // パターンB: 少額随契を超え、かつ特殊事由に該当する場合 (第2号〜第9号)
                const detail = REASON_DETAILS[specialReason];
                article = `施行令第167条の2第1項第${specialReason}号 (${detail.name.split('(')[1].replace(')', '')})`;
                
                // 見積徴取の判定
                if (detail.oneParty) {
                    quotationDetail = '1者のみの徴取で足りる (規則第14条第1項による)';
                    // 第2,3,5,6号は1者随契可だが、7,8,9号は不可。
                    if (specialReason === '5') {
                        notes.push('【緊急時】可能であれば複数の業者から見積を徴取するなど競争性を確保するよう心がけてください。');
                    }
                } else {
                    quotationDetail = '原則として2者以上の徴取が必要 (ただし入札不調/落札者辞退の場合は別途手続き)';
                }
                
                notes.push(detail.notes);
                notes.push(detail.document);

                flowNote += `（予定価格 ${priceMan}万円は第1号の上限額 ${priceLimit}万円を超過しています。特殊事由（第${specialReason}号）が適用されました。）`;

            } else {
                // パターンC: 少額随契を超え、特殊事由にも該当しない場合
                article = '随意契約の適用不可';
                quotationDetail = '一般競争入札又は指名競争入札が必要です。';
                notes.push('**【原則】** 地方自治法第234条第2項により、この場合は随意契約は適用できません。**一般競争入札**を原則として検討してください。');
                notes.push('価格が50万円を超えているため、予定価格調書の作成は必須です。');
                flowNote = `（予定価格 ${priceMan}万円は上限額 ${priceLimit}万円を超過しており、かつ特殊事由が選択されていません。）`;
            }

            // 結果の反映と表示
            resultArticle.textContent = article;
            resultQuotation.textContent = quotationDetail;
            resultFlow.textContent = flowNote;

            // 注意事項リストのクリアと再設定
            ['note1', 'note2', 'note3'].forEach((id, index) => {
                document.getElementById(id).textContent = notes[index] || '';
                // 3つ以上の注意事項がある場合のための処理（結果が一つにまとまっている場合は不要だが念のため）
                if (index === 2 && notes.length > 3) {
                    document.getElementById(id).textContent += ` 他 ${notes.length - 3}件の注意事項があります。`;
                }
            });

            // 結果エリアの表示
            output.classList.remove('hidden');
        }

        // ページロード時の初期設定
        document.addEventListener('DOMContentLoaded', () => {
            // Enterキーでの判定を無効化 (フォーム送信防止)
            document.getElementById('plannedPrice').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    e.preventDefault();
                    judgeContract();
                }
            });
        });

    </script>
</body>
</html>
